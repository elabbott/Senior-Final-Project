<script>
	$(document).ready(function() {
		$('.table').DataTable({});
	})
</script>

<header>
	<%= render 'layouts/navigation' %>
</header>
<% if current_user.franchise == false && current_user.user_type == 2 %>

<h1 class="text-center">Welcome, <%= current_user.fname %> <%= current_user.lname %></h1>

<%= button_to "Register my child", new_child_path, :method => :get%>
<% @orders = Order.where(:parent_id => current_user.id) rescue nil %>
<br>
<table class="table">
	<thead>
		<th>Name</th>
		<th>Date of Birth</th>
		<th>School</th>
		<th>Purchase Meals</th>
	</thead>
	<tbody>
		<%Child.where(:parent_id => current_user.id).each do |child|%>

		<tr>
			<td><%= child.name %></td>
			<td><%= child.dob %></td>
			<td><%= School.find_by_id(child.school_id).name %></td>
			<td><%= button_to "Purchase meals", add_meal_to_child_path(child.id), :method => :get%></td>

		</tr>
		<%end%>
	</tbody>

</table>

<h1>Your incomplete orders</h1>
<table class="table">
	<thead>
		<th>Total</th>
		<th>Child</th>
		<th>Pay</th>

	</thead>
	<tbody>
		<%Order.where(:parent_id => current_user.id, :complete => false).each do |order|%>

		<tr>
			<td><%= order.price %></td>
			<td><%= Child.find_by_id(order.child_id).name %></td>
			<td><%= button_to "Pay", payment_path(order.id), :method => :get%></td>


		</tr>
		<%end%>
	</tbody>

<table>

<% elsif current_user.user_type == 2 %>
	<h1 class="text-center">Welcome, <%= current_user.fname %> <%= current_user.lname %>.</h1>
	<div class="left">
	<%= button_to "Request Franchise", new_franchise_path, method: :get %>
	</div>
	<div class="right">
 	<!--<%= button_to "Create a Menu", add_meal_to_meal_list_path(current_user.id), :method => :get%> -->

	</div>
	<p></p>


	<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion1<%=params[:id]%>" href="#collapseOne1<%=params[:id]%>" aria-expanded="true" aria-controls="collapseOne"> Franchise List </a></h4>
    </div>
    <div id="collapseOne1<%=params[:id]%>" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
      <div class="panel-body">
        <table class="table table-striped table-bordered" id='franchiseList'>
          <thead>
          <tr>
            <td>Name</td>
            <td>School Name</td>
          </tr>
          </thead>
          <tbody>
          <% Franchise.where(:user_id => current_user.id, :approved => true).each do |franchises|%>
          <tr>
            <td><%= franchises.name %></td>
            <td><%= School.find_by_id(franchises.school_id).name%></td>
            <td><%= button_to "Create a Menu", new_meal_list_path, :method => :get%></td>
            <td>select meals for franchise button</td>
            <td>see meal list button</td>
            <td>handle money // view orders button</td>
          </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  </div>
  		<div class="panel-group" id="accordion2" role="tablist" aria-multiselectable="true">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingTwo">
      <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion2<%=params[:id]%>" href="#collapseOne2<%=params[:id]%>" aria-expanded="true" aria-controls="collapseOne"> Pending Franchises  </a></h4>
    </div>
    <div id="collapseOne2<%=params[:id]%>" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
      <div class="panel-body">
		<table class="table table-striped table-bordered" id="pendingList">
		<thead>
			<tr>
				<td>Name</td>
				<td>School Name</td>
				<td>Approved</td>
			</tr>
		</thead>
		<tbody>
			<% Franchise.where(:user_id => current_user.id, :approved => false).each do |franchises|%>
			<tr>
				<td><%= franchises.name%></td>
				<td><%= School.find_by_id(franchises.school_id).name%></td>
				<td><%= franchises.approved%></td>
				<td><%= button_to "Cancel", franchise_path(franchises.id), method: :delete %> </td>
			</tr>
			<% end %>
		</tbody>
	</table>
	</div>
	</div>
	</div>
	</div>

<% elsif current_user.user_type == 3 %>
<h1>Welcome, Chef <%= current_user.fname%> <%= current_user.lname%></h1>

<div class="text-center">
	<%= link_to "Create Meal", new_meal_path, :class => "btn btn-primary" %>
</div>
<table class="table table-striped table-bordered">
	<thead>
		<tr>
			<td>Name</td>
			<td>Description</td>
			<td>Calories</td>
			<td>Price</td>
			<td>Edit</td>
		</tr>
	</thead>
	<tbody>
		<% Meal.all.each do |meals|%>
		<tr>
			<td><%= meals.name%></td>
			<td><%= meals.description%></td>
			<td><%= meals.calories%></td>
			<td><%= meals.price %></td>
			<td><%= link_to "Edit Meal", edit_meal_path(meals), :class => "btn btn-primary"%></td>
		</tr>
		<% end %>
	</tbody>
</table>

<% elsif current_user.user_type == 4 %>
<h1 class="text-center">Hello, Admin <%= current_user.fname%> <%= current_user.lname %></h1>

<div class="text-center">
	<%= link_to "Active Admin Dashboard", admin_dashboard_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Children Table", children_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Meals Table", meals_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Schools Table", schools_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Franchise Table", franchises_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Orders Table", orders_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Payment Info Table", payment_infos_path, :class => 'btn btn-primary btn-lg'%>
</div>

	<table class="table table-striped table-bordered">
		<thead>
		Franchises that need approval.
			<tr>
				<td>Owner ID</td>
				<td>Franchise ID</td>
				<td>School ID</td>
				<td>Zipcode</td>
			</tr>
		</thead>
		<tbody>
			<% Franchise.where(:approved => false ).each do |franchises|%> 
			<tr>
				<td><%= franchises.user_id %></td>
				<td><%= franchises.id %></td>
				<td><%= franchises.school_id %></td>
				<td><%= franchises.zipcode %></td>
				<td><%= button_to 'Approve', edit_franchise_path(franchises.id), method: :get %> </td>
			</tr>
			<% end %>
		</tbody>
	</table>
<% end %>

