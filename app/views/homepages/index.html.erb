<script>
	$(document).ready(function() {
		$('.table').DataTable({});
	})
</script>

<header>
	<%= render 'layouts/navigation' %>
</header>
<% if current_user.franchise == false && current_user.user_type == 2 %>

<h1 class="text-center">Welcome, <%= current_user.fname %> <%= current_user.lname %></h1>

<%= button_to "Register my child", new_child_path, :method => :get%>
<% @orders = Order.where(:parent_id => current_user.id) rescue nil %>
<br>
<table class="table">
	<thead>
		<th>Name</th>
		<th>Date of Birth</th>
		<th>School</th>
		<th>Purchase Meals</th>
	</thead>
	<tbody>
		<%Child.where(:parent_id => current_user.id).each do |child|%>

		<tr>
			<td><%= child.name %></td>
			<td><%= child.dob %></td>
			<td><%= School.find_by_id(child.school_id).name %></td>
			<td><%= button_to "Purchase meals", add_meal_to_child_path(child.id), :method => :get%></td>

		</tr>
		<%end%>
	</tbody>

</table>

<h1>Your incomplete orders</h1>
<table class="table">
	<thead>
		<th>Total</th>
		<th>Child</th>
		<th>Pay</th>

	</thead>
	<tbody>
		<%Order.where(:parent_id => current_user.id, :complete => false).each do |order|%>

		<tr>
			<td><%= order.price %></td>
			<td><%= Child.find_by_id(order.child_id).name %></td>
			<td><%= button_to "Pay", payment_path(order.id), :method => :get%></td>


		</tr>
		<%end%>
	</tbody>

<table>

<% elsif current_user.user_type == 2 && current_user.approved == true%>
<h1 class="text-center">Welcome, <%= current_user.fname %> <%= current_user.lname %>.</h1>
<table class="table table-striped table-bordered">
	<thead>
		Your franchise list.
		<tr>
			<td>ID</td>
			<td>School ID</td>
			<td>Approved</td>
		</tr>
	</thead>
	<tbody>
		<% Franchise.where(:user_id => current_user.id).each do |franchises|%>
		<tr>
			<td><%= franchises.id%></td>
			<td><%= franchises.school_id%></td>
			<td><%= franchises.approved%></td>
			<td><%= link_to "View Franchise Page", franchise, :class => "btn btn-primary" %></td>
		</tr>
		<% end %>
	</tbody>
</table>

<% elsif current_user.user_type == 2 && current_user.approved == false && current_user.franchise == true%>
<h1 class="text-center">Welcome, Unapproved Franchise Owner: <%= current_user.fname %> <%= current_user.lname %>.</h1>
<div class="text-center">
	<%= link_to "Request Franchise", new_franchise_path, :class => "btn btn-primary" %>
</div>
<table class="table table-striped table-bordered">
	<thead>
		Schools in your zipcode.
		<tr>
			<td>Name</td>
		</tr>
	</thead>
	<tbody>
		<% School.where(:zipcode => current_user.zipcode).each do |schools|%>
		<tr>
			<td><%= schools.name%></td>
		</tr>
		<% end %>
	</tbody>
</table>

<% elsif current_user.user_type == 3 %>
<h1>Welcome, Chef <%= current_user.fname%> <%= current_user.lname%></h1>

<div class="text-center">
	<%= link_to "Create Meal", new_meal_path, :class => "btn btn-primary" %>
</div>
<table class="table table-striped table-bordered">
	<thead>
		<tr>
			<td>Name</td>
			<td>Description</td>
			<td>Calories</td>
			<td>Price</td>
			<td>Edit</td>
		</tr>
	</thead>
	<tbody>
		<% Meal.all.each do |meals|%>
		<tr>
			<td><%= meals.name%></td>
			<td><%= meals.description%></td>
			<td><%= meals.calories%></td>
			<td><%= meals.price %></td>
			<td><%= link_to "Edit Meal", edit_meal_path(meals), :class => "btn btn-primary"%></td>
		</tr>
		<% end %>
	</tbody>
</table>

<% elsif current_user.user_type == 4 %>
<h1 class="text-center">Hello, Admin <%= current_user.fname%> <%= current_user.lname %></h1>

<div class="text-center">
	<%= link_to "Active Admin Dashboard", admin_dashboard_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Children Table", children_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Meals Table", meals_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Schools Table", schools_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Franchise Table", franchises_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Orders Table", orders_path, :class => 'btn btn-primary btn-lg'%>
</div>
<div class="text-center">
	<%= link_to "Payment Info Table", payment_infos_path, :class => 'btn btn-primary btn-lg'%>
</div>
<table class="table table-striped table-bordered">
	<thead>
		Franchises Owners that need approval.
		<tr>
			<td>Name</td>
			<td>Zipcode</td>
			<td>email</td>
		</tr>
	</thead>
	<tbody>
		<% User.where(:approved => false).each do |users|%>
		<tr>
			<td><%= users.fname%>, <%= users.lname%></td>
			<td><%= users.zipcode %></td>
			<td><%= users.email%></td>
			<td><%= button_to 'Approve'  %> </td>
		</tr>
		<% end %>
	</tbody>
</table>
<table class="table table-striped table-bordered">
	<thead>
		Franchises that need approval.
		<tr>
			<td>Owner ID</td>
			<td>School ID</td>
			<td>Zipcode</td>
		</tr>
	</thead>
	<tbody>
		<% Franchise.where(:approved => false ).each do |franchises|%> <!-- not quite perfect still shows unapproved users -->
		<tr>
			<td><%= franchises.user_id %></td>
			<td><%= franchises.school_id %></td>
			<td><%= franchises.zipcode %></td>
			<td><%= button_to 'Approve' %> </td>
		</tr>
		<% end %>
	</tbody>
</table>
<% end %>

